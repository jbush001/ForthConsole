variable dir
variable anim_frame
16 constant FRAC_SIZE
SCREEN_HEIGHT 16 - constant GROUND_Y

variable xspeed
variable yloc
variable yspeed
variable xloc


: update_chopper
    \ Horizontal movement
    buttons BUTTON_L and if
       0 dir !
       -1 xspeed +!
    else
        buttons BUTTON_R and if
           1 dir !
           1 xspeed +!
        else 
          \ no buttons, decelerate
          xspeed @ 0 > if
             -1 xspeed +!
          then
          xspeed @ 0 < if 
              1 xspeed +!
          then
        then
    then

    \ Vertical movement
    buttons BUTTON_U and if
       \ Rise
       -1 yspeed +!
    else
        yloc @ FRAC_SIZE / GROUND_Y > if
            \ Stop when we hit the ground
            0 yspeed !
            GROUND_Y FRAC_SIZE * yloc !
        else
            buttons BUTTON_D and if
                \ Descent
                1 yspeed +!
            else 
                \ no buttons, decelerate
                yspeed @ 0 > if
                    -1 yspeed +!
                then
                yspeed @ 0 < if 
                    1 yspeed +!
                then
            then
        then
    then

    xspeed @ xloc +!
    yspeed @ yloc +!
;

: draw_frame
    1 cls

    update_chopper

    \ Draw chopper
    xloc @ FRAC_SIZE / yloc @ FRAC_SIZE /
    anim_frame @ if 2 else 0 then
    2 2 dir @ 0 draw_sprite
    anim_frame @ 1 xor anim_frame !
;

: init
   0 dir !
   0 anim_frame !
   0 xspeed !
   0 yspeed !
   GROUND_Y FRAC_SIZE * yloc !
   64 FRAC_SIZE * xloc !
;

init


( sprite data ---xx--xxx----x-xxx----xxxx----x--
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000004000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000044400000000000004440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00004444400004400000444440000440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00044444444444400004444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00044444444440000004444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000444444440000000044444444
)
